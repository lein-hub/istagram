<template lang="">
    <app-layout>
        <div class="lg:w-9/12 lg:mx-auto mt-5 mx-3">
            <div class="flex">
                <div class="w-1/3">
                    <button class="block h-40 w-40 mx-auto border-solid border-6 border-gray-100 rounded-full overflow-hidden focus:outline-none">
                        <img class="object-cover h-full w-full" :src="thisUser.profile_photo_url" alt="">
                    </button>
                </div>
                <section class="w-2/3 pl-5">
                    <div class="flex my-3">
                        <h2 class="mr-5 text-2xl">
                            {{ thisUser.name }}
                        </h2>
                        <div v-if="isMe">
                            <div class="mr-5">
                                <button class="border bg-white rounded mr-5 p-1 font-extrabold" @click="$inertia.get('/user/profile')" tabindex="0">
                                    프로필 편집
                                </button>
                            </div>
                        </div>
                        <div v-else>
                            <div class="mr-5">
                                <a v-if="!isFollowed" class="rounded mr-5 p-1 font-extrabold bg-blue-500 cursor-pointer" @click="clickFollow" tabindex="0">
                                    팔로우 하기
                                </a>
                                <a v-else class="rounded mr-5 p-1 font-extrabold bg-red-500 cursor-pointer" @click="clickUnfollow" tabindex="0">
                                    언팔로우 하기
                                </a>
                            </div>
                        </div>
                    </div>
                    <ul class="flex relative my-3">
                        <li class="mr-5">
                            <span class="">
                                게시물
                                <span class="font-extrabold">
                                    {{ posts.length }}
                                </span>
                            </span>
                        </li>
                        <li class="mr-5">
                            <span @click="showFollowers = true" class="cursor-pointer" tabindex="0">
                                팔로워
                                <span class="font-extrabold" title="92">
                                    {{ thisUser.followers.length }}
                                </span>
                            </span>
                        </li>
                        <li class="mr-5">
                            <span  @click="showFollowings = true" class="cursor-pointer" tabindex="0">
                                팔로우
                                <span class="font-extrabold">
                                    {{ thisUser.followings.length }}
                                </span>
                            </span>
                        </li>
                    </ul>
                    <!-- <div class="my-3">
                        <h1 class="font-extrabold">
                            박동재
                        </h1><br>
                    </div> -->
                </section>
            </div>
            <div class="bg-green-300 mt-16 grid justify-items-center">
                <div class="bg-green-500 w-1/3 flex px-3 justify-between">
                    <button>1</button>
                    <button>2</button>
                    <button>3</button>
                </div>
            </div>
            <div class="grid grid-cols-3 lg:gap-7 gap-1">
                <div v-for="post in posts" :key="post.id" class="relative h-0 pb-2/3 pt-1/3 bg-black cursor-pointer">
                    <post-preview :post="post"></post-preview>
                </div>
            </div>
        </div>
        <user-list :users="thisUser.followings" :title="'follow'" :show="showFollowings" @close="showFollowings = false"></user-list>
        <user-list :users="thisUser.followers" :title="'follower'" :show="showFollowers" @close="showFollowers = false"></user-list>
    </app-layout>
</template>
<script>
import AppLayout from '@/Layouts/AppLayout.vue'
import PostPreview from '@/Pages/PostPreview.vue'
import UserList from './UserList.vue'

export default {
    props: [
        'thisUser',
        'posts',
    ],
    components: {
        AppLayout,
        PostPreview,
        UserList
    },
    data() {
        return {
            isMe: false,
            isFollowed: false,
            showFollowings: false,
            showFollowers: false,
        }
    },
    methods: {
        clickFollow() {
            this.$inertia.form({
                id: this.thisUser.id,
            }).post('/user/requestFollow', {
                onSuccess: () => this.isFollowed = true,
            });
        },
        clickUnfollow() {
            this.$inertia.form({
                id: this.thisUser.id,
            }).post('/user/requestUnfollow', {
                onSuccess: () => this.isFollowed = false,
            });
        },
    },
    created() {
        for (let key in this.thisUser.followers) {
            if (this.thisUser.followers[key].id == this.$page.props.user.id) {
                this.isFollowed = true;
                break;
            }
        }
        if (this.thisUser.id == this.$page.props.user.id) {
            this.isMe = true;
        }
    },
}
</script>
<style lang="">

</style>
